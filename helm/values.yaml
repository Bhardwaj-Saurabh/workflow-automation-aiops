# Microservices Architecture - Values
# This configuration deploys separate frontend and backend services

# Backend Service Configuration
backend:
  replicaCount: 3
  
  image:
    repository: ghcr.io/bhardwaj-saurabh/ai-assessment-backend
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  
  resources:
    limits:
      cpu: 1500m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  env:
    OPENAI_MODEL: "gpt-4o-mini"
    OPENAI_TEMPERATURE: "0.3"
    CONFIDENCE_THRESHOLD: "0.7"
    MAX_RETRIES: "3"
    DEBUG: "False"

# Frontend Service Configuration
frontend:
  replicaCount: 2
  
  image:
    repository: ghcr.io/bhardwaj-saurabh/ai-assessment-frontend
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  
  service:
    type: LoadBalancer
    port: 80
    targetPort: 8501
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70
  
  env:
    BACKEND_API_URL: "http://ai-assessment-backend:8000"
    API_TIMEOUT: "300"

# Shared Configuration
imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false

# Ingress for Frontend
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: ai-assessment.example.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
  tls:
    - secretName: ai-assessment-tls
      hosts:
        - ai-assessment.example.com

# Secrets
secrets:
  openaiApiKey: ""  # Set via: --set secrets.openaiApiKey=sk-...

# Health Probes
backend:
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

frontend:
  livenessProbe:
    httpGet:
      path: /_stcore/health
      port: 8501
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /_stcore/health
      port: 8501
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

nodeSelector: {}
tolerations: []
affinity: {}
